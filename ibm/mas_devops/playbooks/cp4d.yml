---
- hosts: localhost
  any_errors_fatal: true
  vars:
    # You must turn on the components of CP4D that you want to install in this playbook.
    # By default nothing will be installed
    install_cp4d_platform: "{{ lookup('env', 'CPD_INSTALL_PLATFORM') | default('False', true) | bool }}"
    install_watson_studio: "{{ lookup('env', 'CPD_INSTALL_WSL') | default('False', False) | bool }}"
    install_watson_machine_learning: "{{ lookup('env', 'CPD_INSTALL_WML') | default('False', true) | bool }}"
    install_analytics_engine: "{{ lookup('env', 'CPD_INSTALL_SPARK') | default('False', true) | bool }}"
    install_watson_openscale: "{{ lookup('env', 'CPD_INSTALL_OPENSCALE') | default('False', true) | bool }}"
    install_spss_modeler: "{{ lookup('env', 'CPD_INSTALL_SPSS') | default('False', true) | bool }}"
    install_cognos_analytics: "{{ lookup('env', 'CPD_INSTALL_COGNOS') | default('False', true) | bool }}"
    cpd_product_version: "{{ lookup('env', 'CPD_PRODUCT_VERSION') | default('5.1.3', true) }}"

  roles:
    # Cloud Pak for Data Platform (~1 1/2 hours)
    - role: ibm.mas_devops.ibm_catalogs
      when: install_cp4d_platform == true

    # Watson Studio (~3 hours)
    - role: ibm.mas_devops.cp4d_service
      when: install_watson_studio == true
      vars:
        cpd_service_name: wsl

    # Watson Machine Learning (~2 1/2 hours)
    - role: ibm.mas_devops.cp4d_service
      when: install_watson_machine_learning == true
      vars:
        cpd_service_name: wml

    # Analytics Engine Powered by Apache Spark (~30 minutes)
    - role: ibm.mas_devops.cp4d_service
      when: install_analytics_engine == true
      vars:
        cpd_service_name: spark

    # Watson OpenScale (~1 hour)
    - role: ibm.mas_devops.cp4d_service
      when: install_watson_openscale == true
      vars:
        cpd_service_name: aiopenscale

    # SPSS MODELER
    - role: ibm.mas_devops.cp4d_service
      when: install_spss_modeler == true
      vars:
        cpd_service_name: spss

    # COGNOS ANALYTICS
    - role: ibm.mas_devops.cp4d_service
      when: install_cognos_analytics == true
      vars:
        cpd_service_name: ca
