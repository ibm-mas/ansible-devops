---
- name: Remove finalizers from CRs of {{ crd_name }}
  shell: |
    for ns in ibm-cpd ibm-cpd-operators; do
      for cr in $(oc get {{ crd_name }} -n $ns -o name 2>/dev/null); do
        echo "Removing stuck finalizers from $cr in $ns"
        oc get $cr -n $ns -o json | jq 'del(.metadata.finalizers)' | oc replace -f - || true
        oc delete $cr -n $ns --ignore-not-found || true
      done
    done
  ignore_errors: true
