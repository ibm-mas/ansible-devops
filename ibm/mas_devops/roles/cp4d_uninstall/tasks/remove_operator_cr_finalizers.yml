---
- name: Remove finalizers from CP4D operator CRs
  shell: |
    for ns in ibm-cpd ibm-cpd-operators; do
      for crd in $(oc get crd -o name | grep -E 'cpd.ibm.com|zen.cpd.ibm.com|commonservice' || true); do
        for cr in $(oc get $crd -n $ns -o name 2>/dev/null); do
          echo "Removing finalizers from $cr in $ns"
          oc get $cr -n $ns -o json | jq 'del(.metadata.finalizers)' | oc replace -f - || true
        done
      done
    done
  ignore_errors: true
  