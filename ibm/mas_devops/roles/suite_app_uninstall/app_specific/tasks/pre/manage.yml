# 1. Delete ManageDeployment CR
# -----------------------------------------------------------------------------
- name: "Get ManageDeployment CR"
  kubernetes.core.k8s_info:
    api_version: "apps.mas.ibm.com/v1"
    kind: "ManageDeployment"
    namespace: "{{ mas_app_namespace }}"
  register: app_deployment_lookup

- name: "Delete ManageDeployment CR"
  kubernetes.core.k8s:
    state: absent
    api_version: "{{ item.apiVersion }}"
    kind: "{{ item.kind }}"
    namespace: "{{ item.metadata.namespace }}"
    name: "{{ item.metadata.name }}"
    wait: true
    wait_timeout: 1200 # 20 minutes
  loop: "{{ app_deployment_lookup.resources }}"
