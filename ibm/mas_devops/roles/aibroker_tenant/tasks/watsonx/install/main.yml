---
- name: "Check if WatsonX AI API key secret exists in namespace: {{ aibroker_namespace }}"
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Secret
    name: "{{ tenant_namespace }}----wx-secret"
    namespace: "{{ aibroker_namespace }}"
  register: wx_apikey_secret_info

- name: Create WatsonX AI API Key
  script: "{{ role_path }}/files/create_wx.sh {{ tenant_namespace }} {{ aibroker_namespace }} {{ mas_aibroker_watsonxai_apikey }} {{ mas_aibroker_watsonxai_url }} {{ mas_aibroker_watsonxai_project_id }}"
  when:
    - wx_apikey_secret_info.resources | length == 0

# Copy secrets to tenant namespace
- name: 'Copy secret {{ tenant_namespace }}----wx-secret to namespace: {{ tenant_namespace }}'
  shell: 'oc get secret {{ item }} -n mas-{{ mas_instance_id }}-aibroker -o yaml | sed "s/namespace: .*/namespace: {{ tenant_namespace }}/" | oc apply --force -f -'
  with_items:
    - '{{ tenant_namespace }}----wx-secret'
