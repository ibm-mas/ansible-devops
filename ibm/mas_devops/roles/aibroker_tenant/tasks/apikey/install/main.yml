---
- name: "Check if API key secret exists in namespace: {{ aibroker_namespace }}"
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Secret
    name: "{{ mas_aibroker_tenant_namespace }}----apikey-secret"
    namespace: "{{ aibroker_namespace }}"
  register: apikey_secret_info

- name: Create API Key
  script: "{{ role_path }}/files/create_apikey.sh {{ mas_aibroker_tenant_namespace }} {{ aibroker_namespace }}"
  when:
    - apikey_secret_info.resources | length == 0
