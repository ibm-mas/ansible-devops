---
# Detect if this is an install-from-backup scenario
- name: "Check for backup restore variables"
  set_fact:
    install_from_backup: "{{ (db2_backup_version is defined and db2_backup_version != '' and db2_backup_version != 'None') and (mas_backup_dir is defined and mas_backup_dir != '') }}"

- include_tasks: tasks/install/get-backup-info.yml
  when:
    - install_from_backup | bool

# Fail if required parameters are not set
# -----------------------------------------------------------------------------
- name: "Fail if required properties have not been provided"
  assert:
    that:
      - db2_instance_name is defined and db2_instance_name != ""
      - ibm_entitlement_key is defined and ibm_entitlement_key != ""
    fail_msg: "One or more required properties have not been set"
  when: not install_from_backup | bool

# Start the installation task
# -----------------------------------------------------------------------------
- include_tasks: tasks/install/install.yml

# Start database restore task
# -----------------------------------------------------------------------------
- include_tasks: tasks/restore_database/restore-database.yml
  when: install_from_backup | bool
