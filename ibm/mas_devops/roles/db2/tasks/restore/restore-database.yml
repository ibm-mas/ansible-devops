---
# Check db2 Restore required variables
# -----------------------------------------------------------------------------
- name: Verify DB2 restore variables
  ibm.mas_devops.verify_backup_restore_vars:
    component: "db2"
    action: "{{ db2_action }}_database"
    db2_backup_version: "{{ db2_backup_version }}"
    mas_backup_dir: "{{ mas_backup_dir }}"
    db2_instance_name: "{{ db2_instance_name }}"
    backup_vendor: "{{ backup_vendor }}"

# Check s3 variables when backup vendor is s3
# -----------------------------------------------------------------------------
- name: "Verify DB2 S3 variables"
  ibm.mas_devops.verify_backup_restore_vars:
    component: "db2"
    action: "s3_setup"
    backup_vendor: "{{ backup_vendor }}"
    backup_s3_alias: "{{ backup_s3_alias }}"
    backup_s3_endpoint: "{{ backup_s3_endpoint }}"
    backup_s3_bucket: "{{ backup_s3_bucket }}"
    backup_s3_access_key: "{{ backup_s3_access_key }}"
    backup_s3_secret_key: "{{ backup_s3_secret_key }}"
  when: backup_vendor == "s3"

- name: "Start database restore process"
  debug:
    msg:
      - "------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"
      - "Starting restore process from {{ backup_vendor }} for DB2 database from backup version {{ db2_backup_version }}"
      - "------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"

- name: "Run restore-db-from-disk.yml when backup vendor is disk"
  include_tasks: "{{ role_path }}/tasks/restore/restore-db-from-{{ backup_vendor }}.yml"
