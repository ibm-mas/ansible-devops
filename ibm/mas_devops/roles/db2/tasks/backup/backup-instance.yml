---
- name: DB2 Instance backup configuration summary
  ansible.builtin.debug:
    msg:
      - "================== BACKUP DB2 INSTANCE CONFIGURATION SUMMARY =================="
      - "MAS INSTANCE ID   : {{ mas_instance_id | default('UNDEFINED') }}"
      - "DB2 INSTANCE NAME : {{ db2_instance_name | default('UNDEFINED') }}"
      - "NAMESPACE         : {{ db2_namespace | default('UNDEFINED') }}"
      - "DB NAME           : {{ db2_dbname | default('UNDEFINED') }}"
      - "BACKUP VERSION    : {{ db2_backup_version | default('UNDEFINED') }}"
      - "BACKUP DIR        : {{ db2_backup_path | default('UNDEFINED') }}"
      - "================================================================================"

- name: "Start Db2 Instance backup process."
  ibm.mas_devops.backup_db2_instance:
    db2_backup_path: "{{ db2_backup_path }}"
    db2_namespace: "{{ db2_namespace }}"
    db2_instance_name: "{{ db2_instance_name | lower }}"
    mas_instance_id: "{{ mas_instance_id }}"
    db2_dbname: "{{ db2_dbname }}"
  register: db2_instance_backup_result

- name: "Assert Db2 Instance backup success"
  assert:
    that:
      - db2_instance_backup_result is defined
      - db2_instance_backup_result.success == true
    fail_msg: "Db2 Instance resources backup failed."

- name: DB2 Instance backup summary
  ansible.builtin.debug:
    msg:
      - "================== BACKUP DB2 INSTANCE CONFIGURATION SUMMARY =================="
      - "MAS INSTANCE ID   : {{ mas_instance_id | default('UNDEFINED') }}"
      - "DB2 INSTANCE NAME : {{ db2_instance_name | default('UNDEFINED') }}"
      - "NAMESPACE         : {{ db2_namespace | default('UNDEFINED') }}"
      - "DB NAME           : {{ db2_dbname | default('UNDEFINED') }}"
      - "BACKUP VERSION    : {{ db2_backup_version | default('UNDEFINED') }}"
      - "BACKUP DIR        : {{ db2_backup_path | default('UNDEFINED') }}"
      - "STATUS            : SUCCESS"
      - "================================================================================"
