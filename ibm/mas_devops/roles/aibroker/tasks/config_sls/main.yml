---
- name: "Read sls config file"
  ansible.builtin.set_fact:
    slscfg: "{{ lookup('file', '{{ mas_config_dir }}/sls.yml') | from_yaml_all }}"

- name: "Set sls mandatory vars"
  ansible.builtin.set_fact:
    slscfg:
      secret_name: "{{ slscfg[0].metadata.name }}"
      registration_key: "{{ slscfg[0].stringData.registrationKey }}"
      url: "{{ slscfg[1].spec.config.url }}"
      # ca: "{{ slscfg[1].spec.certificates | map(attribute='crt') | join(',') }}"
      ca: "{{ slscfg[1].spec.certificates | map(attribute='crt') }}"

- name: "Debug: sls information" #TODO: remove before PR
  debug:
    msg:
      - "sls secret name ......... {{ slscfg.secret_name }}"
      - "sls registration key .... {{ slscfg.registration_key }}"
      - "sls url ................. {{ slscfg.url }}"
      - "sls cert ca ............. {{ slscfg.ca }}"

- name: "Create secret for SLS registration key"
  kubernetes.core.k8s:
    apply: yes
    template: "templates/sls/sls-tenant-details.yml.j2"
