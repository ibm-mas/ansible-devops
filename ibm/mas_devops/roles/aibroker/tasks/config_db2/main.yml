---
- name: "Read DB2 config file"
  ansible.builtin.set_fact:
    db2cfg: "{{ lookup('file', '{{ mas_config_dir }}/jdbc-{{ mas_app_id }}-db2.yml') | from_yaml_all }}"

- name: "Set DB2 mandatory vars"
  ansible.builtin.set_fact:
    db2cfg:
      username: "{{ db2cfg[0].data.username }}"
      password: "{{ db2cfg[0].data.password }}"
      url: "{{ db2cfg[1].spec.config.url }}"
      ca: "{{ db2cfg[1].spec.certificates | map(attribute='crt') | join(',') | replace(',', '\n') }}"

- name: "Debug: DB2 information" #TODO: remove before PR
  debug:
    msg:
      - "DB2 username ............. {{ db2cfg.username }}"
      - "DB2 password ............. {{ db2cfg.password }}"
      - "DB2 url .................. {{ db2cfg.url }}"
      - "DB2 cert ca .............. {{ db2cfg.ca }}"

- name: "Create secret for DB2 admin credentials"
  kubernetes.core.k8s:
    apply: yes
    template: "templates/db2/db2-admin-credentials.yml.j2"

