---
apiVersion: apps.mas.ibm.com/v1
kind: AiBrokerApp
metadata:
    name: "{{ mas_instance_id }}"
    namespace: "{{ aibroker_namespace }}"
    labels:
        mas.ibm.com/applicationId: aibroker
        mas.ibm.com/instanceId: "{{ mas_instance_id }}"
spec:
    settings:
        icr:
            cp: "{{ mas_icr_cp }}"
            cpopen: "{{ mas_icr_cpopen }}"
        dro:
            url: "{{ drocfg.url }}"
            dro_token_secret: "{{ mas_aibroker_dro_token_secret }}"
            ca: "{{ drocfg.ca }}"
        jdbc:
            url: "{{ jdbccfg.url | b64decode }}"
            credentials_secret: "{{ mas_aibroker_jdbc_secret }}"
            ca: |
{% for line in (jdbccfg.ca | b64decode).split('\n') %}
        {{ line }}
{% endfor %}
        cluster_domain: "{{ cluster_domain }}"
        in_saas_env: "{{ mas_aibroker_saas }}"
        minio: 
            host: "{{ mas_aibroker_storage_host }}"
            port: "{{ mas_aibroker_storage_port }}"
            credentials_secret: "{{ mas_aibroker_minio_secret }}"
            pipeline_bucket: "{{ mas_aibroker_storage_pipelines_bucket }}"
            tenants_bucket: "{{ mas_aibroker_storage_tenants_bucket }}"
            templates_bucket: "{{ mas_aibroker_storage_templates_bucket }}"
        mariadb:
            host: "{{ mas_aibroker_db_host }}"
            port: "{{ mas_aibroker_db_port }}"
            credentials_secret: "{{ mas_aibroker_mariadb_secret }}"
            database_name: "{{ mas_aibroker_db_secret_name }}"
