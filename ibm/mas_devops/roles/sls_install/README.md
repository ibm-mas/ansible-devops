sls_install
===========

Install **IBM Suite License Service** and generate properties that can be used in the [gencfg_sls](gencfg_sls.md) role to create a configuration that can be directly applied to IBM Maximo Application Suite.

The role assumes that you have already installed the Certificate Manager in the target cluster.  This action is performed by the [ocp_setup_mas_deps](ocp_setup_mas_deps.md) role if you want to use this collection to install the cert-manager operator.

Role Variables
--------------

### sls_entitlement_key
API Key for entitled registry. This password will be used to create the image pull secret.

- **Required**
- Environment Variable: `SLS_ENTITLEMENT_KEY` or `IBM_ENTITLEMENT_KEY`
- Default: None

### sls_catalog_source
Defines the OLM catalog to be used to install SLS. Set to `ibm-sls-operators` if you want to deploy pre-release development builds of SLS or leave as the default `ibm-operator-catalog` for the released versions.

- Optional
- Environment Variable: `SLS_CATALOG_SOURCE`
- Default: `ibm-operator-catalog`

### sls_channel
The SLS OLM subscription channel to be installed.

- Optional
- Environment Variable: `SLS_CHANNEL`
- Default: `3.x`

### sls_namespace
Define the namespace where sls must be installed.

- Optional
- Environment Variable: `SLS_NAMESPACE`
- Default: `ibm-sls`

### sls_icr_cp
The container registry source for all container images deployed by the SLS operator. Override to use development images

- Optional
- Environment Variable: `SLS_ICR_CP`
- Default: `cp.icr.io/cp`

### sls_icr_cpopen
The container registry source for the SLS operator container image. Override to use development image

- Optional
- Environment Variable: `SLS_ICR_CPOPEN`
- Default: `icr.io/cpopen`

### sls_instance_name
Defines the instance ID to be used for SLS installation.

- Optional
- Environment Variable: `SLS_INSTANCE_NAME`
- Default: `sls`

### sls_entitlement_username
Username for entitled registry. This username will be used to create the image pull secret.

- Optional
- Environment Variable: `SLS_ENTITLEMENT_USERNAME`
- Default: `cp`

### sls_domain
SLS can be configured to be externally accessible through a route by setting the domain. Set the domain if SLS is used by application suites that are installed in separate OpenShift clusters.

- Optional
- Environment Variable: `SLS_DOMAIN`
- Default: None

### sls_auth_enforce
Determines whether authorization is enforced. If set to true, clients must use mTLS with certificates generated from the client registration flow for SLS API calls.

- Optional
- Environment Variable: `SLS_AUTH_ENFORCE`
- Default: `True`

### sls_compliance_enforce
Determines whether compliance is enforced. If there are not enough tokens to support the request. If compliance is not enforced, license checkout requests will be allowed even if there are not enough tokens to support the request.

- Optional
- Environment Variable: `SLS_COMPLIANCE_ENFORCE`
- Default: `True`

### sls_registration_open
Determines whether registration is open. If set to true, clients will be able to register themselves with SLS and use SLS APIs.

- Optional
- Environment Variable: `SLS_REGISTRATION_OPEN`
- Default: `True`

### bootstrap.license_id
Defines the License Id to be used to bootstrap SLS. Don't set if you wish to setup entitlement later on

- Optional
- Environment Variable: `SLS_LICENSE_ID`
- Default: None

### bootstrap.registration_key
Defines the Registration Key to be used to bootstrap SLS. Don't set if you wish to setup entitlement later on

- Optional
- Environment Variable: `SLS_REGISTRATION_KEY`
- Default: None

### bootstrap.license_file
Defines the License File to be used to bootstrap SLS. Don't set if you wish to setup entitlement later on. Note: this variable used to be called bootstrap.entitlement_file and defaulted to `{{mas_config_dir}}/entitlement.lic`, this is no longer the case and `SLS_LICENSE_FILE` has to be set in order to bootstrap.

- Optional
- Environment Variable: `SLS_LICENSE_FILE`
- Default: None

### sls_mongodb_cfg_file
Location of a MAS MongoCfg defintion (as generated by the `mongodb` role).  If provided the role will use the information in that config file to configure SLS.

- Either `sls_mongodb_cfg_file` or the `sls_mongodb` object are required to configure MongoDb.
- Environment Variable: `SLS_MONGODB_CFG_FILE`
- Default: None

### sls_mongodb.hosts
Defines list of host and port pair for MongoDb to be used with SLS.

- Either `sls_mongodb_cfg_file` or the `sls_mongodb` object are required to configure MongoDb.
- Environment Variable: None
- Default: None

### sls_mongodb.username
Defines the MongoDB Username.

- Either `sls_mongodb_cfg_file` or the `sls_mongodb` object are required to configure MongoDb.
- Environment Variable: None
- Default: None

### sls_mongodb.password
Defines the MongoDb Password.

- Either `sls_mongodb_cfg_file` or the `sls_mongodb` object are required to configure MongoDb.
- Environment Variable: None
- Default: None


Example Playbook
----------------

```yaml
- hosts: localhost
  any_errors_fatal: true
  vars:
    sls_entitlement_key: "{{ lookup('env', 'SLS_ENTITLEMENT_KEY') }}"
    sls_mongodb_cfg_file: "/etc/mas/mongodb.yml"

    bootstrap:
      license_id: "aa78dd65ef10"
      license_file: "/etc/mas/entitlement.lic"
      registration_key: "{{ lookup('env', 'SLS_REGISTRATION_KEY') }}"

  roles:
    - ibm.mas_devops.sls_install
```


License
-------

EPL-2.0
