---
# 1. Enabled backwards for the older "install-dro" command
# -----------------------------------------------------------------------------
- name: Backwards compatibility mode for "install-dro" action
  when: dro_action == "install-dro"
  set_fact:
    dro_action: "install"


# 2. Validate chosen action
# -----------------------------------------------------------------------------
- name: Validate DRO_ACTION value
  assert:
    that:
      - dro_action is defined
      - dro_action | length > 0
      - dro_action in ["install", "uninstall", "skip"]
    fail_msg: "Incorrect value set for DRO_ACTION, support actions are install (install-dro), uninstall, and skip"


# 3. Run the defined action
# -----------------------------------------------------------------------------
- name: install/uninstall DRO
  include_tasks: "tasks/{{ dro_action }}/main.yml"
  when: dro_action in ["install", "uninstall"]


# 4. Generate the DRO configuration for MAS
# -----------------------------------------------------------------------------
- name: gencfg for new installation
  include_tasks: tasks/gencfg/main.yml
  when:
    - dro_action not in ["uninstall", "skip"]
    - mas_config_dir is defined and mas_config_dir != ""
