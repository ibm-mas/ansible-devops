<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>registry - MAS DevOps Ansible Collection</title>

    <!-- Pure CSS (https://pure-css.github.io/) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
    <link rel="stylesheet" href="../../css/theme.css">

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>
    <script src="../../js/theme.js"></script>

    <!-- Carbon theme zones (white, g10, g90, g100) -->
    <link rel="stylesheet" href="https://1.www.s81c.com/common/carbon/web-components/tag/latest/themes.css">

    <!-- The Carbon web-components/framework -->
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/version/v2.15.0/ui-shell.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/version/v2.15.0/accordion.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/version/v2.15.0/breadcrumb.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/version/v2.15.0/select.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/version/v2.15.0/tabs.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/version/v2.15.0/search.min.js"></script>

    <!-- HighlightJS code formatting support -->
    <link rel="stylesheet" id="hljs-light" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <link rel="stylesheet" id="hljs-dark" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
    <script>hljs.highlightAll();</script>

    <!-- Required by MkDocs search -->
    <script>var base_url = "../..";</script>

    <!-- User defined extras -->
    
    

    

    
    <script src="../../search/main.js"></script>
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: black; }
        </style></head>

  <body class="md-grid" data-theme-default="g90">
    <!-- Header -->
    <cds-header aria-label="MAS DevOps Ansible Collection" class="md-header">
      <cds-header-menu-button button-label-active="Close menu" button-label-inactive="Open menu"></cds-header-menu-button>
      <cds-header-name href="../.." prefix="IBM">MAS DevOps Ansible Collection</cds-header-name>
      <cds-header-nav menu-bar-label="IBM MAS DevOps Ansible Collection">
          <cds-header-nav-item is-active target="" href="">Ansible</cds-header-nav-item>
          <cds-header-nav-item target="" href="https://ibm-mas.github.io/cli/">CLI</cds-header-nav-item>
      </cds-header-nav>

      <div class="cds--header__global">
<div class="md-theme-toggle" data-theme-default="g90">
  <button class="md-theme-toggle__button" aria-label="Toggle theme" title="Toggle theme">
    <svg class="md-theme-toggle__icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"></path>
    </svg>
  </button>
  <div class="md-theme-toggle__menu" hidden>
    <button class="md-theme-toggle__option" data-theme="white">
      <span class="md-theme-toggle__label">Light</span>
      <span class="md-theme-toggle__preview md-theme-toggle__preview--white"></span>
    </button>
    <button class="md-theme-toggle__option" data-theme="g10">
      <span class="md-theme-toggle__label">Light Gray</span>
      <span class="md-theme-toggle__preview md-theme-toggle__preview--g10"></span>
    </button>
    <button class="md-theme-toggle__option" data-theme="g90">
      <span class="md-theme-toggle__label">Dark Gray</span>
      <span class="md-theme-toggle__preview md-theme-toggle__preview--g90"></span>
    </button>
    <button class="md-theme-toggle__option" data-theme="g100">
      <span class="md-theme-toggle__label">Dark</span>
      <span class="md-theme-toggle__preview md-theme-toggle__preview--g100"></span>
    </button>
  </div>
</div>
        <cds-search id="header-search" label-text="Search" cds-search-input="search-event" expandable></cds-search>
      </div>
      <script>
        var el = document.getElementById("header-search");
        el.addEventListener("cds-search-input", function (ev) {
          console.info(ev.detail.value)
          document.getElementById("header-search-value").setAttribute("value", ev.detail.value);
        });
        el.addEventListener('keydown', function (ev) {
          if (ev.key === 'Enter') {
            location.href="../../search.html?q=" + document.querySelector("#header-search").shadowRoot.querySelector("#input").value;
          }
        });
      </script>

      
    </cds-header>

    <!-- Main container with three-column layout -->
    <div class="md-container">
      <!-- Left sidebar - Navigation -->
      <aside class="md-sidebar md-sidebar--primary" data-md-component="sidebar">
        <div class="md-sidebar__scrollwrap">
          <div class="md-sidebar__inner">
            <cds-side-nav aria-label="Side navigation">
              <cds-side-nav-items>
                
                  
  <cds-side-nav-menu title="General Information">
    
      
  <cds-side-nav-menu-item href="../..">
    Home
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../execution-environment/">
    Ansible Automation Platform
  </cds-side-nav-menu-item>

    
  </cds-side-nav-menu>

                
                  
  <cds-side-nav-menu title="Playbooks">
    
      
  <cds-side-nav-menu-item href="../../playbooks/ocp/">
    OCP
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/cp4d/">
    Install Cloud Pak For Data
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/aiservice/">
    Install AI Service
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-core/">
    Install Core
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-iot/">
    Add IoT
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-manage/">
    Add Manage
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-monitor/">
    Add Monitor
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-optimizer/">
    Add Optimizer
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-predict/">
    Add Predict
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-visualinspection/">
    Add Visual Inspection
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-facilities/">
    Add Real Estate and Facilities
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-update/">
    Update
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/mas-upgrade/">
    Upgrade
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../../playbooks/backup-restore/">
    Backup &amp; Restore
  </cds-side-nav-menu-item>

    
  </cds-side-nav-menu>

                
                  
  <cds-side-nav-menu title="Roles: OCP Mgmt">
    
      
  <cds-side-nav-menu-item href="../ocp_cluster_monitoring/">
    ocp_cluster_monitoring
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_config/">
    ocp_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_deprovision/">
    ocp_deprovision
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_efs/">
    ocp_efs
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_github_oauth/">
    ocp_github_oauth
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_login/">
    ocp_login
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_node_config/">
    ocp_node_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_provision/">
    ocp_provision
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_roks_upgrade_registry_storage/">
    ocp_roks_upgrade_registry_storage
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_upgrade/">
    ocp_upgrade
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_verify/">
    ocp_verify
  </cds-side-nav-menu-item>

    
  </cds-side-nav-menu>

                
                  
  <cds-side-nav-menu title="Roles: Dependency Mgmt">
    
      
  <cds-side-nav-menu-item href="../aws_bucket_access_point/">
    aws_bucket_access_point
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../aws_documentdb_user/">
    aws_documentdb_user
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../aws_policy/">
    aws_policy
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../aws_route53/">
    aws_route53
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../aws_user_creation/">
    aws_user_creation
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../aws_vpc/">
    aws_vpc
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../cert_manager/">
    cert_manager
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../cis/">
    cis
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../configure_manage_eventstreams/">
    configure_manage_eventstreams
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../cos/">
    cos
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../cos_bucket/">
    cos_bucket
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../cp4d_admin_pwd_update/">
    cp4d_admin_pwd_update
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../cp4d/">
    cp4d
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../cp4d_service/">
    cp4d_service
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../db2/">
    db2
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../dro/">
    dro
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../eck/">
    eck
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../grafana/">
    grafana
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ibm_catalogs/">
    ibm_catalogs
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../kafka/">
    kafka
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../longhorn/">
    longhorn
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../nvidia_gpu/">
    nvidia_gpu
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../mongodb/">
    mongodb
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocs/">
    ocs
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../sls/">
    sls
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../turbonomic/">
    turbonomic
  </cds-side-nav-menu-item>

    
  </cds-side-nav-menu>

                
                  
  <cds-side-nav-menu title="Roles: Image Mirroring" active expanded>
    
      
  <cds-side-nav-menu-item href="../mirror_case_prepare/">
    mirror_case_prepare
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../mirror_extras_prepare/">
    mirror_extras_prepare
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../mirror_images/">
    mirror_images
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../mirror_ocp/">
    mirror_ocp
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_idms/">
    ocp_idms
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../ocp_simulate_disconnected_network/">
    ocp_simulate_disconnected_network
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="./" active expanded>
    registry
  </cds-side-nav-menu-item>

    
  </cds-side-nav-menu>

                
                  
  <cds-side-nav-menu title="Roles: Suite Mgmt">
    
      
  <cds-side-nav-menu-item href="../suite_app_config/">
    suite_app_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_app_install/">
    suite_app_install
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_app_uninstall/">
    suite_app_uninstall
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_app_upgrade/">
    suite_app_upgrade
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_app_rollback/">
    suite_app_rollback
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_app_backup_restore/">
    suite_app_backup_restore
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_certs/">
    suite_certs
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_config/">
    suite_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_db2_setup_for_manage/">
    suite_db2_setup_for_manage
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_dns/">
    suite_dns
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_install/">
    suite_install
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_attachments_config/">
    suite_manage_attachments_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_birt_report_config/">
    suite_manage_birt_report_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_bim_config/">
    suite_manage_bim_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_customer_files_config/">
    suite_manage_customer_files_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_imagestitching_config/">
    suite_manage_imagestitching_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_import_certs_config/">
    suite_manage_import_certs_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_load_dbc_scripts/">
    suite_manage_load_dbc_scripts
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_logging_config/">
    suite_manage_logging_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_manage_pvc_config/">
    suite_manage_pvc_config
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_uninstall/">
    suite_uninstall
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_upgrade/">
    suite_upgrade
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_rollback/">
    suite_rollback
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_verify/">
    suite_verify
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../suite_backup_restore/">
    suite_backup_restore
  </cds-side-nav-menu-item>

    
  </cds-side-nav-menu>

                
                  
  <cds-side-nav-menu title="Roles: Utilities">
    
      
  <cds-side-nav-menu-item href="../ansible_version_check/">
    ansible_version_check
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../entitlement_key_rotation/">
    entitlement_key_rotation
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../gencfg_jdbc/">
    gencfg_jdbc
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../gencfg_watsonstudio/">
    gencfg_watsonstudio
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../gencfg_workspace/">
    gencfg_workspace
  </cds-side-nav-menu-item>

    
      
  <cds-side-nav-menu-item href="../gencfg_mongo/">
    gencfg_mongo
  </cds-side-nav-menu-item>

    
  </cds-side-nav-menu>

                
              </cds-side-nav-items>
            </cds-side-nav>
          </div>
        </div>
      </aside>

      <!-- Main content area -->
      <div class="md-content" data-md-component="content">
        <article class="md-content__inner">
          <!-- Breadcrumbs -->
          <div class="md-breadcrumbs"><cds-breadcrumb no-trailing-slash>
  <cds-breadcrumb-item>
    <cds-breadcrumb-link href="../..">Home</cds-breadcrumb-link>
  </cds-breadcrumb-item>
      <cds-breadcrumb-item>Roles: Image Mirroring</cds-breadcrumb-item>
  <cds-breadcrumb-item>
    <cds-breadcrumb-link href="#registry">registry</cds-breadcrumb-link>
  </cds-breadcrumb-item>

  <cds-breadcrumb-item aria-current="page">
    <cds-select id="breadcrumbs-toc" inline placeholder="..." oninput="changeAnchor(this.value)">
    
    
      <cds-select-item value="#usage">Usage</cds-select-item>
    
      <cds-select-item value="#role-variables">Role Variables</cds-select-item>
    
      <cds-select-item value="#example-playbook">Example Playbook</cds-select-item>
    
      <cds-select-item value="#license">License</cds-select-item>
    
    </cds-select>
  </cds-breadcrumb-item>
</cds-breadcrumb>
          </div>

          <!-- Page content -->
          <div class="rst-content">
            
            <h1 id="registry">registry<a class="headerlink" href="#registry" title="Permanent link">¤</a></h1>
<p>Create a Docker Registry running on RedHat OpenShift cluster.  The registry will be backed by persistant storage, and accessible via either a clusterIP or loadbalancer service. This role can also be used to delete a docker registry on a cluster for a clean start. See usage below for more information.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">¤</a></h2>
<p>If you set up the registry with a <strong>loadbalancer</strong> service you will be able to push to the registry via the cluster's hostname, but before you can use the registry you will need to install the registry's CA certificate and restart the Docker daemon so that your client trusts the new registry:</p>
<pre><code class="language-bash">CACERT=$(oc -n airgap-registry get secret airgap-registry-certificate -o jsonpath='{.data.ca\.crt}' | base64 -d)
DOMAIN=$(oc get ingress.config cluster -o jsonpath='{.spec.domain}')
sudo mkdir -p /etc/docker/certs.d/$DOMAIN\:32500/
sudo echo "$CACERT" &gt; /etc/docker/certs.d/$DOMAIN\:32500/ca.crt
sudo service docker restart
</code></pre>
<p>You can now use the registry as normal:</p>
<pre><code class="language-bash">DOMAIN=$(oc get ingress.config cluster -o jsonpath='{.spec.domain}')
docker pull registry.access.redhat.com/ubi8/ubi-minimal
docker tag registry.access.redhat.com/ubi8/ubi-minimal $DOMAIN:32500/ubi8/ubi-minimal
docker push $DOMAIN:32500/ubi8/ubi-minimal
</code></pre>
<p>If you set up the registry with a <strong>clusterip</strong> service you will only be able to push to the registry after using port forwarding:</p>
<pre><code class="language-bash">oc -n airgap-registry port-forward deployment/airgap-registry 9000:5000

docker pull registry.access.redhat.com/ubi8/ubi-minimal
docker tag registry.access.redhat.com/ubi8/ubi-minimal localhost:9000/ubi8/ubi-minimal
docker push localhost:9000/ubi8/ubi-minimal
</code></pre>
<p>However, you will still need to set up Docker trust for the "local" registry:</p>
<pre><code class="language-bash">CACERT=$(oc -n airgap-registry get secret airgap-registry-certificate -o jsonpath='{.data.ca\.crt}' | base64 -d)
sudo mkdir -p /etc/docker/certs.d/$DOMAIN\:32500/
sudo mkdir /etc/docker/certs.d/localhost\:9000
sudo echo "$CACERT" &gt; /etc/docker/certs.d/localhost\:9000/ca.crt
sudo service docker restart
</code></pre>
<p>Usage for tear-down action
This role can also be used to permanently delete a mirror registry from a given cluster by setting the <code>registry_action</code> to <code>tear-down</code> and specifying the corresponding <code>registry_namespace</code>, if not using the default value.</p>
<p>Note that the tear-down action deletes the registry completely including the PVC storage and the registry namespace. To start up the registry again, the role needs to be run again with the registry_action on default or <code>setup</code>. Images previously stored in the registry before the tear-down will no longer be available and will need to be mirrored again once the registry setup has completed. Take precaution when using this function and expect that images can no longer be accessed from the registry that has been torn down.</p>
<p><strong>Note:</strong> Recreating the registry will also create a new ca cert for the new registry.</p>
<p>An appropriate time to use this tear-down function is when the registry has too many images that are not being used or when there has been a shift to support newer versions but images of older versions are clogging the registry. The tear-down function frees the disk space and allows for a new registry to be setup.</p>
<h2 id="role-variables">Role Variables<a class="headerlink" href="#role-variables" title="Permanent link">¤</a></h2>
<h3 id="registry_action">registry_action<a class="headerlink" href="#registry_action" title="Permanent link">¤</a></h3>
<p>Action to perform with the registry deployment.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>REGISTRY_ACTION</code></li>
<li>Default: <code>setup</code></li>
</ul>
<p><strong>Purpose</strong>: Controls whether to set up a new registry or tear down an existing one.</p>
<p><strong>When to use</strong>: Set to <code>tear-down</code> when you need to completely remove a registry to free disk space or start fresh. Use default <code>setup</code> for normal installation.</p>
<p><strong>Valid values</strong>:
- <code>setup</code> - Install and configure the registry
- <code>tear-down</code> - Permanently delete the registry, namespace, and all stored images</p>
<p><strong>Impact</strong>: The <code>tear-down</code> action is destructive and irreversible. All images stored in the registry will be lost, and the PVC storage will be deleted. A new CA certificate will be generated if the registry is recreated.</p>
<p><strong>Related variables</strong>: <a href="#registry_namespace"><code>registry_namespace</code></a></p>
<p><strong>Notes</strong>:
- Use tear-down when the registry contains too many unused images or when migrating to newer versions
- After tear-down, you must re-mirror all required images
- Docker clients will need to trust the new CA certificate after recreation</p>
<h3 id="registry_namespace">registry_namespace<a class="headerlink" href="#registry_namespace" title="Permanent link">¤</a></h3>
<p>Namespace where the Docker registry will be deployed.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>REGISTRY_NAMESPACE</code></li>
<li>Default: <code>airgap-registry</code></li>
</ul>
<p><strong>Purpose</strong>: Isolates the registry resources in a dedicated namespace for organization and access control.</p>
<p><strong>When to use</strong>: Override the default if you have namespace naming conventions or need multiple registries in the same cluster.</p>
<p><strong>Valid values</strong>: Any valid Kubernetes namespace name (lowercase alphanumeric and hyphens)</p>
<p><strong>Impact</strong>: All registry resources (deployment, service, PVC, secrets) will be created in this namespace. The namespace will be deleted during tear-down operations.</p>
<p><strong>Related variables</strong>: <a href="#registry_action"><code>registry_action</code></a></p>
<p><strong>Notes</strong>: Ensure the namespace name doesn't conflict with existing namespaces in your cluster.</p>
<h3 id="registry_storage_class">registry_storage_class<a class="headerlink" href="#registry_storage_class" title="Permanent link">¤</a></h3>
<p>Storage class for the registry's persistent volume.</p>
<ul>
<li><strong>Required</strong> (except on IBM Cloud ROKS where it defaults to <code>ibmc-block-gold</code>)</li>
<li>Environment Variable: <code>REGISTRY_STORAGE_CLASS</code></li>
<li>Default: None (IBM Cloud ROKS: <code>ibmc-block-gold</code>)</li>
</ul>
<p><strong>Purpose</strong>: Provides persistent storage for container images stored in the registry.</p>
<p><strong>When to use</strong>: Must be specified for all non-ROKS clusters. On ROKS, the default is usually appropriate unless you have specific performance requirements.</p>
<p><strong>Valid values</strong>: Any storage class name available in your cluster that supports ReadWriteOnce (RWO) access mode. Common examples:
- IBM Cloud ROKS: <code>ibmc-block-gold</code>, <code>ibmc-block-silver</code>, <code>ibmc-block-bronze</code>
- AWS: <code>gp2</code>, <code>gp3</code>, <code>io1</code>
- Azure: <code>managed-premium</code>, <code>managed-standard</code>
- On-premises: Depends on your storage provider</p>
<p><strong>Impact</strong>: Determines the performance characteristics and availability of the registry storage. The storage class must support RWO access mode.</p>
<p><strong>Related variables</strong>: <a href="#registry_storage_capacity"><code>registry_storage_capacity</code></a></p>
<p><strong>Notes</strong>:
- Verify the storage class exists before deployment: <code>oc get storageclass</code>
- The storage class cannot be changed after initial deployment without recreating the registry</p>
<h3 id="registry_storage_capacity">registry_storage_capacity<a class="headerlink" href="#registry_storage_capacity" title="Permanent link">¤</a></h3>
<p>Size of the persistent volume claim for registry storage.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>REGISTRY_STORAGE_CAPACITY</code></li>
<li>Default: <code>100Gi</code></li>
</ul>
<p><strong>Purpose</strong>: Allocates disk space for storing container images in the registry.</p>
<p><strong>When to use</strong>: Increase from the default based on the number and size of images you plan to store. Consider your mirroring requirements and image retention policies.</p>
<p><strong>Valid values</strong>: Any valid Kubernetes storage size (e.g., <code>100Gi</code>, <code>500Gi</code>, <code>1Ti</code>). Must be supported by your storage class.</p>
<p><strong>Impact</strong>: Determines how many images can be stored before the registry runs out of space. Insufficient capacity will cause push operations to fail.</p>
<p><strong>Related variables</strong>: <a href="#registry_storage_class"><code>registry_storage_class</code></a></p>
<p><strong>Notes</strong>:
- Plan for growth - container images can be large (1-5GB each)
- Monitor usage regularly: <code>oc get pvc -n &lt;registry_namespace&gt;</code>
- Expanding PVC size after deployment depends on your storage class capabilities
- For airgap environments, calculate total size of all images to be mirrored plus 20% buffer</p>
<h3 id="registry_service_type">registry_service_type<a class="headerlink" href="#registry_service_type" title="Permanent link">¤</a></h3>
<p>Service type for exposing the registry.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>REGISTRY_SERVICE_TYPE</code></li>
<li>Default: <code>loadbalancer</code></li>
</ul>
<p><strong>Purpose</strong>: Controls how the registry is exposed for access from Docker clients.</p>
<p><strong>When to use</strong>:
- Use <code>loadbalancer</code> (default) when you need to push images from outside the cluster
- Use <code>clusterip</code> when you only need internal cluster access or will use port-forwarding</p>
<p><strong>Valid values</strong>:
- <code>loadbalancer</code> - Exposes registry externally via cluster domain on port 32500
- <code>clusterip</code> - Internal cluster access only (requires port-forwarding for external access)</p>
<p><strong>Impact</strong>:
- <strong>loadbalancer</strong>: Enables direct external access via <code>&lt;cluster-domain&gt;:32500</code>, but requires port 32500 to be available
- <strong>clusterip</strong>: More secure (no external exposure) but requires <code>oc port-forward</code> for each push operation</p>
<p><strong>Related variables</strong>: None</p>
<p><strong>Notes</strong>:
- <strong>LIMITATION</strong>: The loadbalancer port (32500) cannot be customized. If port 32500 is already in use by another service, you must use <code>clusterip</code> mode
- With loadbalancer, you must install the registry's CA certificate on your Docker client (see Usage section)
- With clusterip, you still need to configure Docker trust for localhost:9000 (see Usage section)</p>
<h2 id="example-playbook">Example Playbook<a class="headerlink" href="#example-playbook" title="Permanent link">¤</a></h2>
<pre><code class="language-yaml">- hosts: localhost
  any_errors_fatal: true
  vars:
    registry_storage_class: ibmc-block-gold
    registry_storage_capacity: 500Gb
    registry_service_type: loadbalancer
  roles:
    - ibm.mas_devops.registry
</code></pre>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link">¤</a></h2>
<p>EPL-2.0</p>
            
          </div>

          <!-- Navigation footer (prev/next) -->
<nav class="md-footer-nav" aria-label="Footer navigation">
  <div class="md-footer-nav__inner">
    <a href="../ocp_simulate_disconnected_network/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
      <div class="md-footer-nav__direction">
        <svg class="md-footer-nav__icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path>
        </svg>
        <span>Previous</span>
      </div>
      <div class="md-footer-nav__title">
        <span class="md-footer-nav__title-text">ocp_simulate_disconnected_network</span>
      </div>
    </a>
    <a href="../suite_app_config/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
      <div class="md-footer-nav__direction">
        <span>Next</span>
        <svg class="md-footer-nav__icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"></path>
        </svg>
      </div>
      <div class="md-footer-nav__title">
        <span class="md-footer-nav__title-text">suite_app_config</span>
      </div>
    </a>
  </div>
</nav>
        </article>
      </div>

      <!-- Right sidebar - Table of Contents -->
      <aside class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<nav class="md-sidebar md-sidebar--secondary" aria-label="Table of contents">
  <div class="md-sidebar__scrollwrap">
    <div class="md-sidebar__inner">
      <div class="md-toc">
        <div class="md-toc__title">On this page</div>
        <ul class="md-toc__list">
              <li class="md-toc__item">
                <a href="#usage" class="md-toc__link" data-md-level="1">
                  Usage
                </a>
              </li>
              <li class="md-toc__item">
                <a href="#role-variables" class="md-toc__link" data-md-level="1">
                  Role Variables
                </a>
                  <ul class="md-toc__list">
                      <li class="md-toc__item">
                        <a href="#registry_action" class="md-toc__link" data-md-level="2">
                          registry_action
                        </a>
                      </li>
                      <li class="md-toc__item">
                        <a href="#registry_namespace" class="md-toc__link" data-md-level="2">
                          registry_namespace
                        </a>
                      </li>
                      <li class="md-toc__item">
                        <a href="#registry_storage_class" class="md-toc__link" data-md-level="2">
                          registry_storage_class
                        </a>
                      </li>
                      <li class="md-toc__item">
                        <a href="#registry_storage_capacity" class="md-toc__link" data-md-level="2">
                          registry_storage_capacity
                        </a>
                      </li>
                      <li class="md-toc__item">
                        <a href="#registry_service_type" class="md-toc__link" data-md-level="2">
                          registry_service_type
                        </a>
                      </li>
                  </ul>
              </li>
              <li class="md-toc__item">
                <a href="#example-playbook" class="md-toc__link" data-md-level="1">
                  Example Playbook
                </a>
              </li>
              <li class="md-toc__item">
                <a href="#license" class="md-toc__link" data-md-level="1">
                  License
                </a>
              </li>
        </ul>
      </div>
    </div>
  </div>
</nav>
      </aside>
    </div>

    <!-- Footer - Full width outside container -->
    <footer class="md-footer">
      Built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/durera/mkdocs-carbon">Carbon theme</a>
    </footer>
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": false, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
</script></body></html>