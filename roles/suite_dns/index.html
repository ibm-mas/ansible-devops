<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ibm-mas.github.io/ansible-devops/roles/suite_dns/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>suite_dns - MAS Devops Collection</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "suite_dns";
        var mkdocs_page_input_path = "roles/suite_dns.md";
        var mkdocs_page_url = "/ansible-devops/roles/suite_dns/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MAS Devops Collection
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Playbooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/ocp/">OCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-core/">Install Core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-manage/">Add Manage</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: OCP Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_deprovision/">ocp_deprovision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_disable_updates/">ocp_disable_updates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_github_oauth/">ocp_github_oauth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_login/">ocp_login</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_provision/">ocp_provision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_roks_upgrade_registry_storage/">ocp_roks_upgrade_registry_storage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_upgrade/">ocp_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_verify/">ocp_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Dependency Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../appconnect/">appconnect</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager/">cert_manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager_upgrade/">cert_manager_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager_upgrade_check/">cert_manager_upgrade_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cluster_monitoring/">cluster_monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos/">cos</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_hack_worker_nodes/">cp4d_hack_worker_nodes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_install/">cp4d_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_install_services/">cp4d_install_services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_upgrade/">cp4d_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_wds/">cp4d_wds</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2/">db2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2_backup/">db2_backup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2_restore/">db2_restore</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kafka/">kafka</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nvidia_gpu/">nvidia_gpu</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mongodb/">mongodb</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocs/">ocs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sbo/">sbo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sbo_upgrade/">sbo_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sls/">sls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uds/">uds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Suite Mgmt</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_config/">suite_app_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_install/">suite_app_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_config/">suite_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_db2_setup_for_manage/">suite_db2_setup_for_manage</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">suite_dns</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#cloud-internet-services-cis">Cloud Internet Services (CIS)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#top-level-dns-entries">Top Level DNS entries</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#subdomain-dns-entries">Subdomain DNS entries</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#webhook">Webhook</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables">Role Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cpd_services_namespace">cpd_services_namespace</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configure_suite_cp4d_route">configure_suite_cp4d_route</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook">Example Playbook</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#license">License</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_install/">suite_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_mustgather/">suite_mustgather</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_mustgather_download/">suite_mustgather_download</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_upgrade/">suite_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_upgrade_check/">suite_upgrade_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_verify/">suite_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Utilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ansible_version_check/">ansible_version_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_jdbc/">gencfg_jdbc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_workspace/">gencfg_workspace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install_operator/">install_operator</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MAS Devops Collection</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Roles: Suite Mgmt &raquo;</li><li>suite_dns</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/ibm-mas/ansible-devops/blob/master/docs/roles/suite_dns.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="suite_dns">suite_dns<a class="headerlink" href="#suite_dns" title="Permanent link"></a></h1>
<p>This role will manage MAS and DNS provider integration.  IBM Cloud Internet Services is the only supported DNS provider currently. It will also create a secure route (https://cp4d.<mas_domain>) to the CP4D web client using the custom domain used in this role.</p>
<h3 id="cloud-internet-services-cis">Cloud Internet Services (CIS)<a class="headerlink" href="#cloud-internet-services-cis" title="Permanent link"></a></h3>
<p>This role will create DNS entries automatically in the CIS service instance.  Two different modes are available:</p>
<h4 id="top-level-dns-entries">Top Level DNS entries<a class="headerlink" href="#top-level-dns-entries" title="Permanent link"></a></h4>
<p>This mode will create the entries directly using your DNS zone value. It is usually recommended when you have 1x1 relationship between MAS Instance -&gt; CIS service. e.g: mas.whirlpool.com, where the domain matches exactly the CIS zone name.</p>
<h4 id="subdomain-dns-entries">Subdomain DNS entries<a class="headerlink" href="#subdomain-dns-entries" title="Permanent link"></a></h4>
<p>This mode will create entries using a subdomain. It allows you to have multiple MAS instances using same CIS service. e.g: dev.mas.whirlpool.com, where 'dev' is the subdomain.</p>
<h4 id="webhook">Webhook<a class="headerlink" href="#webhook" title="Permanent link"></a></h4>
<p>The Webhook Task will deploy a cert-manager webhook for CIS integration.  The webhook is responsible for managent the certificate challenge requests from letsencrypt and CIS.  This task will also create two ClusterIssuers by default, pointing to Staging &amp; Production LetsEncrypt servers.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are issues with how cert-manager works with LetsEncrypt staging servers. We end up with a secret for the certificate that doesn't contain the LetsEncrypt CA; but the staging service does not use a well known cert, so we end up with MAS unable to trust the certificates generated by LetsEncrypt staging.</p>
<p>At present there is no workaround for this, so do not use the LetsEncrypt staging certificate issuer.</p>
</div>
<h2 id="role-variables">Role Variables<a class="headerlink" href="#role-variables" title="Permanent link"></a></h2>
<p>TODO: Add other variables</p>
<h3 id="cpd_services_namespace">cpd_services_namespace<a class="headerlink" href="#cpd_services_namespace" title="Permanent link"></a></h3>
<p>The namespace containing the CP4D instance (if configured) on the same cluster as MAS</p>
<ul>
<li>Environment Variable: <code>CPD_SERVICES_NAMESPACE</code></li>
<li>Default: <code>cpd-services</code></li>
</ul>
<h3 id="configure_suite_cp4d_route">configure_suite_cp4d_route<a class="headerlink" href="#configure_suite_cp4d_route" title="Permanent link"></a></h3>
<p>Whether to create a route using the <code>mas_domain</code> to point to the installed CP4D web client on the same OCP cluster as MAS. Route is configured as https://cp4d.<mas_domain> . If you set <code>mas_domain</code> but dont have CP4D installed on the same OCP cluster then set this to <code>False</code>.</p>
<ul>
<li>Environment Variable: <code>CONFIGURE_SUITE_CP4D_ROUTE</code></li>
<li>Default: <code>True</code></li>
</ul>
<h2 id="example-playbook">Example Playbook<a class="headerlink" href="#example-playbook" title="Permanent link"></a></h2>
<pre><code class="language-yaml">---
- hosts: localhost
  any_errors_fatal: true
  vars:
    # Choose which catalog source to use for the MAS install, default to the IBM operator catalog
    mas_catalog_source: &quot;{{ lookup('env', 'MAS_CATALOG_SOURCE') | default('ibm-operator-catalog', true) }}&quot;

    # Which MAS channel to subscribe to
    mas_channel: &quot;{{ lookup('env', 'MAS_CHANNEL') | default('8.x', true) }}&quot;

    # MAS configuration
    custom_domain: &quot;{{ lookup('env', 'MAS_DOMAIN') | default(None)}}&quot;
    mas_instance_id: &quot;{{ lookup('env', 'MAS_INSTANCE_ID') }}&quot;

    # MAS configuration - Entitlement
    mas_entitlement_key: &quot;{{ lookup('env', 'MAS_ENTITLEMENT_KEY') }}&quot;

    # --- DNS settings ----------------------------------------------------------------------------------------
    # you can obtain CRN from overview page of your CIS service in IBM Cloud
    cis_crn: &quot;{{ lookup('env', 'CIS_CRN') }}&quot;
    # Domain prefix is whatever you want to append to your DNS entry to make it unique
    cis_subdomain: &quot;{{ lookup('env', 'CIS_SUBDOMAIN') }}&quot;
    # generate a Service ID apikey in IBM Cloud for strict access to the 'Internet Services` service with
    # an 'Access Policy' of Editor/Manager
    cis_apikey: &quot;{{ lookup('env', 'CIS_APIKEY') | default(lookup('env', 'IBMCLOUD_APIKEY'), true) }}&quot;

    # Email used register letsencrypt certificates and receive cert notifications
    cis_email: &quot;{{ lookup('env', 'CIS_EMAIL') }}&quot;
    # Skip DNS entries creation
    cis_skip_dns_entries: &quot;{{ lookup('env', 'CIS_SKIP_DNS_ENTRIES') | default(false, true) }}&quot;
    # Skip CIS cluster issuer creation, in case you just want to create the DNS entries
    cis_skip_cluster_issuer: &quot;{{ lookup('env', 'CIS_SKIP_CLUSTER_ISSUER') | default(false, true) }}&quot;
    # Do you want to update a DNS entry if it already exists?
    update_dns: &quot;{{ lookup('env', 'UPDATE_DNS_ENTRIES') | default(true, true) }}&quot;
    # e.g: &quot;apps.joaopauloksn.cp.fyre.ibm.com&quot; Default will be always from cluster ingress CR.
    custom_ocp_ingress: &quot;{{ lookup('env', 'OCP_INGRESS') | default(None, true)}}&quot;

    # If cis, custom_cluster_issuer = cis-letsencrypt-production-{{ mas_instance_id }}
    # If PKI, custom_cluster_issuer = MAS_CUSTOM_CLUSTER_ISSUER
    # If not specified, custom_cluster_issuer = autogenerated
    default_custom_cluster_issuer: &quot;'cis-letsencrypt-production-{{ mas_instance_id }}&quot;
    custom_cluster_issuer: &quot;{{ (cis_crn != '') | ternary (lookup('env', 'MAS_CUSTOM_CLUSTER_ISSUER') | default(default_custom_cluster_issuer, true), lookup('env', 'MAS_CUSTOM_CLUSTER_ISSUER') | default(None, true)) }}&quot;
    certificate_duration: &quot;{{ lookup('env', 'CERTIFICATE_DURATION') | default('8760h0m0s', true) }}&quot;
    certificate_renew_before: &quot;{{ lookup('env', 'CERTIFICATE_RENEW_BEFORE') | default('720h0m0s', true) }}&quot;

    mas_config_dir: &quot;{{ lookup('env', 'MAS_CONFIG_DIR') }}&quot;

  roles:
    - ibm.mas_devops.suite_dns
    - ibm.mas_devops.suite_install
    - ibm.mas_devops.suite_config
    - ibm.mas_devops.suite_verify
</code></pre>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link"></a></h2>
<p>EPL-2.0</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/ansible-devops" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../suite_db2_setup_for_manage/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../suite_install/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
