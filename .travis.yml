sudo: required

language: python
python: 3.8

install:
  - $TRAVIS_BUILD_DIR/build/bin/initbuild.sh
  - python -m pip install -q ansible==2.10.3 mkdocs yamllint

script:
  - yamllint -c yamllint.yaml ibm/mas_devops || travis_terminate 1
  - mkdocs build --verbose --clean --strict || travis_terminate 1
  - $TRAVIS_BUILD_DIR/build/bin/build.sh || travis_terminate 1

after_success:
  - $HOME/build.common/bin/gitrelease.sh

deploy:
  provider: pages
  skip_cleanup: true
  github_url: github.com
  github_token: $GITHUB_TOKEN
  verbose: true
  local_dir: site
  target_branch: gh-pages
  on:
    branch: publicrelease
